digraph RegistrationFlow {
    label="Registration Flow";
    labelloc="t";
    fontsize=20;
    fontname="Arial Bold";

    rankdir=TB;
    splines=true;
    nodesep=1.8;

    node [
        shape=box,
        style="rounded,filled",
        fontname="Arial",
        fontsize=12,
        margin="0.3,0.2"
    ];

    edge [
        fontname="Arial",
        fontsize=10,
        color="#666666"
    ];

    // Start
    Home [label="Home Screen", fillcolor="#e8f5e9", color="#388e3c", penwidth=2];

    // Presentation Details - Required before registration
    subgraph cluster_details {
        label="Required before registration";
        labeljust="l";
        style="rounded,dashed";
        color="#9c27b0";
        bgcolor="#f3e5f522";

        PresDetails [label="Press Presentation\nDetails button", fillcolor="#e1bee7", color="#9c27b0"];
        DetailsForm [label="Fill in:\n-----------\n* Topic\n* Abstract\n* Supervisor Name\n* Supervisor Email", fillcolor="#e1bee7", color="#9c27b0", shape=note];
        SaveDetailsBtn [label="Press\n\"Save Details\"", fillcolor="#bbdefb", color="#1976d2"];
    }

    // Select Slot Button (after saving details)
    SelectSlotBtn [label="Press\n\"Select a presentation slot\"", fillcolor="#bbdefb", color="#1976d2"];

    // Browse Slots
    subgraph cluster_browse {
        label="Browse Available Slots";
        labeljust="l";
        style="rounded,dashed";
        color="#1976d2";
        bgcolor="#e3f2fd22";

        AvailableSlots [label="Available Slots", fillcolor="#bbdefb", color="#1976d2"];
        SlotList [label="Slot List\n-----------\n* Date and Time\n* Available Spots", fillcolor="#bbdefb", color="#1976d2", shape=note];
        RegisterBtn [label="Register for Slot", fillcolor="#bbdefb", color="#1976d2"];
    }

    // Registration
    Pending [label="PENDING", fillcolor="#fff9c4", color="#f9a825"];

    // Capacity Check
    CapacityCheck [label="Has Capacity?", fillcolor="#b3e5fc", color="#0288d1", shape=diamond];

    // Waiting List Path
    subgraph cluster_waitlist {
        label="Waiting List (slot full)";
        labeljust="l";
        style="rounded,dashed";
        color="#ff9800";
        bgcolor="#fff3e022";

        Waitlist [label="Added to\nWaiting List", fillcolor="#ffe0b2", color="#ef6c00"];
        WaitlistEmail [label="Notification email\nsent to presenter", fillcolor="#ffe0b2", color="#ef6c00"];
        WaitlistNote [label="Spot became available:\n1. Auto-promoted\n2. Goes to PENDING flow", fillcolor="#ffcc80", color="#ef6c00", shape=note];
    }

    // Supervisor Review
    subgraph cluster_supervisor {
        label="Supervisor Review (has capacity)";
        labeljust="l";
        style="rounded,dashed";
        color="#ff5722";
        bgcolor="#fbe9e722";

        SupervisorEmail [label="Email to Supervisor", fillcolor="#ffccbc", color="#ff5722"];
        SupervisorDecision [label="Supervisor Reviews\n-----------\nApprove or Reject", fillcolor="#ffccbc", color="#ff5722"];
    }

    // Outcomes
    Approved [label="APPROVED\n+ Confirmation Email", fillcolor="#c8e6c9", color="#2e7d32"];
    Rejected [label="REJECTED\n+ Rejection Email", fillcolor="#ef9a9a", color="#b71c1c", shape=ellipse];

    // Connections - Presentation Details
    Home -> PresDetails;
    PresDetails -> DetailsForm;
    DetailsForm -> SaveDetailsBtn;
    SaveDetailsBtn -> SelectSlotBtn [label="saved"];
    SelectSlotBtn -> AvailableSlots;

    // Connections - Browse
    AvailableSlots -> SlotList;
    SlotList -> RegisterBtn [label="tap slot"];
    RegisterBtn -> Pending [label="submit"];

    // Connections - Capacity Check
    Pending -> CapacityCheck;
    CapacityCheck -> Waitlist [label="no\n(slot full)"];
    CapacityCheck -> SupervisorEmail [label="yes\n(has room)"];

    // Connections - Waitlist
    Waitlist -> WaitlistEmail;
    WaitlistEmail -> WaitlistNote;
    WaitlistNote -> Pending [label="promoted", style=dashed, color="#ef6c00", constraint=false];

    // Connections - Supervisor
    SupervisorEmail -> SupervisorDecision;
    SupervisorDecision -> Approved [label="approve"];
    SupervisorDecision -> Rejected [label="reject"];

    // Return paths
    Rejected -> Home [style=dashed, color="#666666", constraint=false];
    Approved -> Home [style=dashed, color="#388e3c", constraint=false];
}
